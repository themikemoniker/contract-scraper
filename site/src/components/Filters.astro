---
interface Props {
  techStack: string[];
  contractTypes: string[];
  remoteTypes: string[];
}

const { techStack, contractTypes, remoteTypes } = Astro.props;
---

<div class="filters">
  <div class="filter-group">
    <label for="search">Search</label>
    <input type="text" id="search" placeholder="Search jobs..." />
  </div>

  <div class="filter-group">
    <label for="tech-filter">Technology</label>
    <select id="tech-filter">
      <option value="">All Technologies</option>
      {techStack.map((tech) => (
        <option value={tech}>{tech}</option>
      ))}
    </select>
  </div>

  <div class="filter-group">
    <label for="contract-filter">Contract Type</label>
    <select id="contract-filter">
      <option value="">All Types</option>
      {contractTypes.map((type) => (
        <option value={type}>{type}</option>
      ))}
    </select>
  </div>

  <div class="filter-group">
    <label for="remote-filter">Remote</label>
    <select id="remote-filter">
      <option value="">All</option>
      {remoteTypes.map((type) => (
        <option value={type}>{type}</option>
      ))}
    </select>
  </div>

  <button id="reset-filters" class="reset-btn">Reset</button>
</div>

<div class="results-count">
  <span id="visible-count">0</span> jobs found
</div>

<script>
  function initFilters() {
    const searchInput = document.getElementById('search') as HTMLInputElement;
    const techFilter = document.getElementById('tech-filter') as HTMLSelectElement;
    const contractFilter = document.getElementById('contract-filter') as HTMLSelectElement;
    const remoteFilter = document.getElementById('remote-filter') as HTMLSelectElement;
    const resetBtn = document.getElementById('reset-filters');
    const visibleCount = document.getElementById('visible-count');

    function filterJobs() {
      const searchTerm = searchInput.value.toLowerCase();
      const tech = techFilter.value;
      const contract = contractFilter.value;
      const remote = remoteFilter.value;

      const jobs = document.querySelectorAll('.job-card');
      let count = 0;

      jobs.forEach((job) => {
        const card = job as HTMLElement;
        const title = card.querySelector('.job-title')?.textContent?.toLowerCase() ?? '';
        const company = card.querySelector('.company')?.textContent?.toLowerCase() ?? '';
        const techStack = card.dataset.tech?.split(',') ?? [];
        const jobContract = card.dataset.contract ?? '';
        const jobRemote = card.dataset.remote ?? '';

        const matchesSearch = !searchTerm ||
          title.includes(searchTerm) ||
          company.includes(searchTerm) ||
          techStack.some(t => t.toLowerCase().includes(searchTerm));

        const matchesTech = !tech || techStack.includes(tech);
        const matchesContract = !contract || jobContract === contract;
        const matchesRemote = !remote || jobRemote === remote;

        if (matchesSearch && matchesTech && matchesContract && matchesRemote) {
          card.style.display = '';
          count++;
        } else {
          card.style.display = 'none';
        }
      });

      if (visibleCount) {
        visibleCount.textContent = String(count);
      }
    }

    searchInput?.addEventListener('input', filterJobs);
    techFilter?.addEventListener('change', filterJobs);
    contractFilter?.addEventListener('change', filterJobs);
    remoteFilter?.addEventListener('change', filterJobs);

    resetBtn?.addEventListener('click', () => {
      searchInput.value = '';
      techFilter.value = '';
      contractFilter.value = '';
      remoteFilter.value = '';
      filterJobs();
    });

    // Initial count
    filterJobs();
  }

  document.addEventListener('DOMContentLoaded', initFilters);
</script>

<style>
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: flex-end;
    padding: 1.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 1rem;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    flex: 1;
    min-width: 150px;
  }

  .filter-group label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .filter-group input,
  .filter-group select {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg);
    color: var(--text);
    font-size: 0.875rem;
  }

  .filter-group input:focus,
  .filter-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .reset-btn {
    padding: 0.5rem 1rem;
    background: var(--border);
    border: none;
    border-radius: 6px;
    color: var(--text-muted);
    font-size: 0.875rem;
    font-weight: 500;
    transition: background 0.2s;
  }

  .reset-btn:hover {
    background: var(--text-muted);
    color: var(--bg);
  }

  .results-count {
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }

  #visible-count {
    font-weight: 600;
    color: var(--text);
  }

  @media (max-width: 640px) {
    .filters {
      flex-direction: column;
    }

    .filter-group {
      width: 100%;
    }
  }
</style>
